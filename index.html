<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olympus Quest Log - Arcade Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background-color: #222222; /* Dark background */
            color: #FFFFFF; /* White text for contrast */
            font-size: 1.125rem; /* Base size INCREASED to text-lg for readability */
        }
        
        .retro-text {
            color: #00FFFF; /* Cyan text for main titles/accents */
        }
        
        .retro-bg {
            background-color: #000000;
            box-shadow: 6px 6px #888888; /* Blocky shadow */
        }
        
        .retro-button {
            background-color: #FFFF00;
            color: #000000;
            border: 3px solid #000000;
            box-shadow: 4px 4px #00FFFF;
            transition: all 0.1s ease-in-out;
            border-radius: 0; /* No rounded corners */
            font-weight: bold; /* Ensure text is chunky */
            font-size: 0.875rem; /* text-sm for button content */
        }
        .retro-button:hover {
            box-shadow: 2px 2px #FF00FF; /* Pink shadow on hover */
            transform: translate(2px, 2px);
        }
        
        .active-tab-retro {
            color: #FFFF00 !important; /* Yellow text when active */
            background-color: #000000 !important;
            border-bottom-color: #00FF00 !important; /* Green line when active */
            box-shadow: 0 4px #00FF00;
        }
        
        .video-frame-container, .chamber-image-container {
            border: 3px solid #FF00FF; /* Pink border */
            box-shadow: 4px 4px #888888;
        }

        .rounded-xl, .rounded-lg, .rounded-full {
            border-radius: 0 !important;
        }

        .mission-list {
            list-style-type: none; /* No default list markers */
            margin-left: 0;
            padding-left: 0;
            font-size: 1rem; /* Text size adjusted */
        }
        .mission-list li:before {
            content: ' > '; /* Retro marker */
            color: #00FF00;
            margin-right: 0.5rem;
        }

    </style>
</head>
<body class="min-h-screen font-sans">

    <!-- Header (Black/Cyan Theme) --><header class="bg-black text-white p-4 shadow-lg sticky top-0 z-10 border-b-4 border-cyan-400">
        <div class="max-w-4xl mx-auto flex flex-col sm:flex-row justify-between items-center">
            <h1 class="text-3xl font-extrabold tracking-tight retro-text">
                <i data-lucide="crown" class="inline-block w-6 h-6 mr-2"></i> OLYMPUS ARCADE QUEST
            </h1>
            <div class="flex flex-col sm:flex-row sm:space-x-4 mt-2 sm:mt-0 text-base opacity-90 text-yellow-400">
                <p id="team-display" class="cursor-pointer font-bold underline hover:text-white" title="Click to change team name">Loading Team...</p>
                <p id="user-display" class="hidden sm:inline">HERO ID: Loading...</p>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs (Black/Yellow/Green Active) --><nav class="bg-gray-800 shadow-inner border-b-4 border-gray-600">
        <div class="max-w-4xl mx-auto flex justify-around text-center py-2">
            <button data-tab="chambers" class="tab-button px-3 py-2 text-base font-bold border-b-4 border-transparent transition duration-0 retro-text active-tab-retro">
                <i data-lucide="map" class="w-4 h-4 inline mr-1"></i> CHAMBERS
            </button>
            <button data-tab="achievements" class="tab-button px-3 py-2 text-base font-bold border-b-4 border-transparent transition duration-0 text-white hover:retro-button-hover">
                <i data-lucide="award" class="w-4 h-4 inline mr-1"></i> POWER-UPS
            </button>
            <button data-tab="rubric" class="tab-button px-3 py-2 text-base font-bold border-b-4 border-transparent transition duration-0 text-white hover:retro-button-hover">
                <i data-lucide="scroll" class="w-4 h-4 inline mr-1"></i> SCORECARD
            </button>
        </div>
    </nav>

    <!-- Main Content Area --><main class="max-w-4xl mx-auto p-4 md:p-8">

        <!-- Tab Content Container --><div id="content-container">
            <!-- Dynamic content will be loaded here --></div>

    </main>

    <!-- Loading Indicator (Retro Style) --><div id="loading-spinner" class="fixed inset-0 bg-black/90 flex items-center justify-center z-50">
        <div class="text-2xl font-bold retro-text animate-pulse">LOADING...</div>
    </div>


    <!-- Firebase Setup and App Logic --><script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // setLogLevel('Debug'); // Uncomment to see Firebase logs

        // Global Firebase variables (provided by the environment)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId;
        
        const TEAM_COLLECTION_PATH = `artifacts/${appId}/public/data/olympus_teams`;
        const STATUS_DOCUMENT_ID = 'progress_status';

        let teamId = null; 
        let userProgress = {}; 

        // --- Data Definitions (UPDATED with image paths) ---
        const chambersData = [
  {
    id: 'chamber1',
    icon: 'zap',
    title: 'Chamber 1: Wake the Hero',
    skill: 'Movement, Stay on Screen & Researching',
    objective: 'Can I move smoothly, stay on screen, and look up how others solved it?',
    mission: `
      <ul class="mission-list">
        <li>Add a player sprite and enable four-way movement.</li>
        <li>Keep the player on screen (stay-in-bounds).</li>
        <li>Extension: set an enemy to auto-move (speed 10).</li>
      </ul>`,
    tip: "If your enemy won't move, double-check the **follow / velocity** settings.",
    story: 'The hero awakens on Olympus. Research a good control scheme and guide the first steps.',
    scorecard: ['MOVEMENT', 'FUN FACTOR', 'RESEARCHING'],
    imageUrl: 'https://raw.githubusercontent.com/GlennMalcolm/Y3T1bMakeCode/refs/heads/main/Lesson%201%20-%20MakeCode%20Year%203%20-%20Mount%20Olympus%20Challenge.png'
  },

  {
    id: 'chamber2',
    icon: 'message-square',
    title: 'Chamber 2: Set the Scene & Speak',
    skill: 'Dialogue & Scene',
    objective: 'Can I build a readable scene and start a simple game story?',
    mission: `
      <ul class="mission-list">
        <li>Choose a clear background that matches your theme.</li>
        <li>Add a dialogue frame with an intro (longer text, readable style).</li>
      </ul>`,
    tip: 'Magpie: Borrow a more legible dialogue style from a successful project.',
    story: 'The skies shift; your tale begins. Make players understand where and why.',
    scorecard: ['GAME STORY', 'SOUND & MUSIC'],
    imageUrl: 'https://raw.githubusercontent.com/GlennMalcolm/Y3T1bMakeCode/refs/heads/main/Lesson%202%20-%20MakeCode%20Year%203%20-%20Mount%20Olympus%20Challenge.png'
  },

  {
    id: 'chamber3',
    icon: 'shield-off',
    title: 'Chamber 3: Danger Rules',
    skill: 'Overlap & Lives',
    objective: 'Can I create fair enemy contact and lose a life on overlap?',
    mission: `
      <ul class="mission-list">
        <li>Play a sound when hero overlaps the enemy.</li>
        <li>Lose 1 life and reset the enemy to a fair position.</li>
      </ul>`,
    tip: 'Test that respawns aren’t instant hits — give the player a chance!',
    story: 'Dark forces awaken; honour demands a fair fight.',
    scorecard: ['ENEMIES', 'FUN FACTOR'],
    imageUrl: 'https://github.com/GlennMalcolm/Y3T1bMakeCode/blob/main/Lesson%203%20-%20MakeCode%20Year%203%20-%20Mount%20Olympus%20Challenge.png?raw=true'
  },

  {
    id: 'chamber4',
    icon: 'gem',
    title: 'Chamber 4: Shiny Coins',
    skill: 'Coins & Score',
    objective: 'Can I spawn, animate, and collect coins for points?',
    mission: `
      <ul class="mission-list">
        <li>Spawn coins every 2 seconds.</li>
        <li>Animate coins so they look shiny.</li>
        <li>On overlap: destroy coin, add +1 score, play a fun sound.</li>
      </ul>`,
    tip: 'Short, happy sounds make collecting feel great.',
    story: 'Gold glitters across Olympus — make it satisfying to collect.',
    scorecard: ['COINS', 'SOUND & MUSIC', 'FUN FACTOR'],
    imageUrl: 'https://github.com/GlennMalcolm/Y3T1bMakeCode/blob/main/Lesson%204%20-%20MakeCode%20Year%203%20-%20Mount%20Olympus%20Challenge.png?raw=true'
  },

  {
    id: 'chamber5',
    icon: 'bar-chart-2',
    title: 'Chamber 5: Levels Unlocked',
    skill: 'Variables & Levels',
    objective: 'Can I change backgrounds or difficulty as the score rises?',
    mission: `
      <ul class="mission-list">
        <li>Use a variable and a forever loop to watch the score.</li>
        <li>Change background or raise difficulty at score bands (0–5, 6–10, 11–15).</li>
      </ul>`,
    tip: 'Make early play friendly; ramp slowly so it stays fair.',
    story: 'As Hercules grows stronger, the world transforms.',
    scorecard: ['LEVELS', 'FUN FACTOR'],
    imageUrl: 'https://github.com/GlennMalcolm/Y3T1bMakeCode/blob/main/Lesson%205%20-%20MakeCode%20Year%203%20-%20Mount%20Olympus%20Challenge.png?raw=true'
  },

  {
    id: 'chamber6',
    icon: 'activity',
    title: 'Chamber 6: The Hydra’s Wrath',
    skill: 'Scaling Enemies',
    objective: 'Can I scale enemy type and speed by level to keep it fair but exciting?',
    mission: `
      <ul class="mission-list">
        <li>If level = 1 → lion enemy; if level = 2 → hydra enemy.</li>
        <li>Enemy speed = level × 10 (or similar).</li>
        <li>(Optional) Random enemy spawns that feel fair.</li>
      </ul>`,
    tip: 'Small speed changes matter — test and tune.',
    story: 'The Hydra rises; only smart scaling can match its fury.',
    scorecard: ['ENEMIES', 'FUN FACTOR'],
    imageUrl: 'https://raw.githubusercontent.com/GlennMalcolm/Y3T1bMakeCode/refs/heads/main/Lesson%206%20-%20MakeCode%20Year%203%20-%20Mount%20Olympus%20Challenge.png'
  },

  {
    id: 'chamber7',
    icon: 'target',
    title: 'Chamber 7: Trial of Olympus',
    skill: 'Boss Battle & Timing',
    objective: 'Can I test, debug, and improve the challenge with help from a friend?',
    mission: `
      <ul class="mission-list">
        <li>Find and fix at least two bugs that affect play.</li>
        <li>Ask a friend to test; record one change from their feedback.</li>
        <li>Tune timing/attacks so the battle is tough but fair.</li>
      </ul>`,
    tip: 'Collaboration makes games better — write down feedback.',
    story: 'Every second counts in this divine duel.',
    scorecard: ['COLLABORATION', 'FUN FACTOR'],
    imageUrl: 'https://github.com/GlennMalcolm/Y3T1bMakeCode/blob/main/Lesson%207%20-%20MakeCode%20Year%203%20-%20Mount%20Olympus%20Challenge.png?raw=true'
  },

  {
    id: 'chamber8',
    icon: 'trophy',
    title: 'Chamber 8: The Hero’s Triumph',
    skill: 'Endgame & Reflection',
    objective: 'Can I share my game, play others’ games, and explain what I learned?',
    mission: `
      <ul class="mission-list">
        <li>Show your game to others (explain controls and goal).</li>
        <li>Play friends’ games and give kind, helpful feedback.</li>
        <li>Reflect: what works well; what would you add next?</li>
      </ul>`,
    tip: 'A short victory screen and clear message make sharing smooth.',
    story: 'Victory! The greatest heroes reflect and share.',
    scorecard: ['COLLABORATION', 'GAME STORY', 'FUN FACTOR'],
    imageUrl: 'https://github.com/GlennMalcolm/Y3T1bMakeCode/blob/main/Lesson%208%20-%20MakeCode%20Year%203%20-%20Mount%20Olympus%20Challenge.png?raw=true'
  }
];
       
        const achievementsData = [
            { icon: 'zap', title: '🧠 Searcher', description: 'Search in the SKILLMAPS to find your clues on how to make things work and learn what makes a good game' },
            { icon: 'crosshair', title: '💥 Bounds', description: 'Successfully add the \'stay on screen\' feature to your character.' },
            { icon: 'gauge', title: '⚡ Scaler', description: 'Correctly multiply an enemy\'s speed by the current level value.' },
            { icon: 'message-square-text', title: '💬 Clue-Smith', description: 'Post a high-quality, helpful tip to the Clue Wall.' },
            { icon: 'zap', title: '🧠 Character-Smith', description: 'Choose Suitable Characters.' },
            { icon: 'crosshair', title: '💥 Mover', description: 'Control Characters with W,A,S,D' },
            { icon: 'gauge', title: '⚡ Collider', description: 'Collisions with items to get points.' },
            { icon: 'message-square-text', title: '💬 Baddies', description: 'Create a moving baddie that moves automatically or follows you' },
            { icon: 'zap', title: '🧠 Loser', description: 'Lose points when baddies collide with you' },
            { icon: 'crosshair', title: '💥 Up Them Points', description: 'Get Points on collisions with coins or scores' },
            { icon: 'gauge', title: '⚡ Level Up', description: 'Make new levels when a score is reached or a tile is walked on' },
            { icon: 'message-square-text', title: '💬 Speedy J', description: 'New Speed on Points - get 20 points and you get a new speed' },
            { icon: 'zap', title: '🧠 Namer', description: 'Match your variable names to what they actually do (e.g., `current_score`).' }
        ];
        const rubricData = [
  { 
    criteria: 'Movement', 
    starting: '🐣 My player can move a little.', 
    getting: '⚔️ My player moves in all directions.', 
    master: '🏆 My player moves smoothly and looks great doing it!' 
  },
  { 
    criteria: 'Enemies', 
    starting: '🐣 I made one enemy that moves.', 
    getting: '⚔️ My enemy can follow or bump into my player.', 
    master: '🏆 My enemy follows fairly and makes the game exciting!' 
  },
  { 
    criteria: 'Coins', 
    starting: '🐣 I made coins appear.', 
    getting: '⚔️ My coins can be collected for points.', 
    master: '🏆 My coins sparkle, add points, and make players happy to collect them!' 
  },
  { 
    criteria: 'Levels', 
    starting: '🐣 I made one level or background.', 
    getting: '⚔️ My game changes background or gets harder as you play.', 
    master: '🏆 My game has different levels that get trickier and more fun!' 
  },
  { 
    criteria: 'Collaboration', 
    starting: '🐣 I mostly worked alone.', 
    getting: '⚔️ I talked and shared ideas with my team.', 
    master: '🏆 I helped my team and shared a cool idea everyone could use!' 
  },
  { 
    criteria: 'Sound & Music', 
    starting: '🐣 My game has some sound.', 
    getting: '⚔️ I added music or sound for actions.', 
    master: '🏆 My sounds and music match the story and make the game awesome!' 
  },
  { 
    criteria: 'Game Story', 
    starting: '🐣 My game has a simple idea.', 
    getting: '⚔️ My game has a story that makes sense.', 
    master: '🏆 My story is creative, clear, and makes players want to keep playing!' 
  },
  { 
    criteria: 'Fun Factor', 
    starting: '🐣 My game works, but it’s a bit plain.', 
    getting: '⚔️ My game is fun and a little challenging.', 
    master: '🏆 My game is super fun, fair, and makes people want to play again!' 
  }
];



        // --- Firebase Functions ---

        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                userId = auth.currentUser?.uid || crypto.randomUUID();
                document.getElementById('user-display').textContent = `HERO ID: ${userId.substring(0, 8)}...`;

                promptForTeamId();

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                document.getElementById('user-display').textContent = 'Error loading hero.';
                document.getElementById('loading-spinner').classList.add('hidden');
                // Fallback to simplified UI if Firebase fails
            }
        }

        function promptForTeamId() {
            let storedTeamId = localStorage.getItem('olympus_team_id');
            
            if (!storedTeamId) {
                storedTeamId = window.prompt("WELCOME HERO! ENTER YOUR TEAM NAME (E.G., TEAM HERCULES):", "TEAM NAME");
            }
            
            if (storedTeamId && storedTeamId.trim() !== '') {
                teamId = storedTeamId.trim();
                localStorage.setItem('olympus_team_id', teamId);
                document.getElementById('team-display').textContent = `TEAM ID: ${teamId.toUpperCase()}`;
                setupProgressListener();
            } else {
                teamId = `solo-${userId}`;
                document.getElementById('team-display').textContent = `SOLO MODE: ${userId.substring(0, 8)}...`;
                setupProgressListener();
            }
        }

        document.getElementById('team-display').addEventListener('click', () => {
            localStorage.removeItem('olympus_team_id'); 
            document.getElementById('loading-spinner').classList.remove('hidden');
            document.getElementById('content-container').innerHTML = ''; 
            promptForTeamId();
        });


        function setupProgressListener() {
            if (!teamId || !db) return;

            const docRef = doc(db, TEAM_COLLECTION_PATH, teamId, 'progress', STATUS_DOCUMENT_ID);
            
            if(teamId.startsWith('solo-') && teamId.length > 5) {
                const privatePath = `artifacts/${appId}/users/${userId}/olympus_progress/status`;
                onSnapshot(doc(db, privatePath), handleSnapshot, handleError);
            } else {
                onSnapshot(docRef, handleSnapshot, handleError);
            }

            function handleSnapshot(docSnap) {
                if (docSnap.exists()) {
                    userProgress = docSnap.data() || {};
                    console.log(`Current progress for ${teamId}:`, userProgress);
                } else {
                    userProgress = {}; 
                    console.log(`No progress found for ${teamId}. Starting fresh.`);
                }
                renderActiveTab();
                document.getElementById('loading-spinner').classList.add('hidden');
            }

            function handleError(error) {
                console.error("Error listening to progress:", error);
                document.getElementById('loading-spinner').classList.add('hidden');
            }
        }

        async function updateProgress(chamberId, isComplete) {
            if (!db || !teamId) {
                console.error("Database or Team ID not initialized.");
                return;
            }

            let docRef;
            if(teamId.startsWith('solo-')) {
                const privatePath = `artifacts/${appId}/users/${userId}/olympus_progress/status`;
                docRef = doc(db, privatePath);
            } else {
                docRef = doc(db, TEAM_COLLECTION_PATH, teamId, 'progress', STATUS_DOCUMENT_ID);
            }
            
            userProgress[chamberId] = isComplete;

            try {
                await setDoc(docRef, userProgress, { merge: true });
                console.log(`Progress updated for ${teamId} (${chamberId}: ${isComplete})`);
            } catch (e) {
                console.error("Error updating document: ", e);
            }
        }


        // --- UI Rendering Functions (RETRO STYLED) ---

        function renderChambers() {
            const html = chambersData.map(chamber => {
                const isCompleted = userProgress[chamber.id] === true;
                
                const completeClass = isCompleted 
                    ? 'bg-green-600 border-green-400 shadow-none text-black' 
                    : 'bg-gray-800 border-yellow-400 retro-bg text-white';
                
                const checkIcon = isCompleted ? 'check-square' : 'square';
                const titleColor = isCompleted ? 'text-black' : 'retro-text';

                return `
                    <div id="${chamber.id}" class="chamber-card p-4 rounded-none transition duration-100 border-4 ${completeClass}" data-chamber-id="${chamber.id}">
                        <div class="flex items-start justify-between cursor-pointer" onclick="window.toggleChamberContent('${chamber.id}')">
                            <div class="flex items-center">
                                <i data-lucide="${chamber.icon}" class="w-7 h-7 mr-4 ${titleColor}"></i>
                                <div>
                                    <h2 class="text-2xl font-bold ${titleColor}">${chamber.title.toUpperCase()}</h2>
                                    <p class="text-base font-semibold text-yellow-400">${chamber.skill.toUpperCase()}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button class="toggle-complete retro-button p-3" data-chamber-id="${chamber.id}">
                                    <i data-lucide="${checkIcon}" class="w-5 h-5 text-black"></i>
                                </button>
                                <i data-lucide="chevron-down" class="w-6 h-6 text-yellow-400 chamber-toggle-icon transition duration-100"></i>
                            </div>
                        </div>

                        <div class="chamber-content mt-3 hidden border-t-2 border-gray-600 pt-3">
                            <div class="p-4 bg-gray-900 border-2 border-cyan-400 text-lg text-white">
                                <!-- Image display for the chamber with adjusted styling for portrait A4 -->${chamber.imageUrl ? `
                                <p class="font-bold retro-text mb-3">🖼️ CHALLENGE OVERVIEW:</p>
                                <div class="chamber-image-container relative w-full max-w-xs mx-auto overflow-hidden shadow-md mb-6" style="height: auto;">
                                    <img src="${chamber.imageUrl}" alt="${chamber.title} Overview" class="w-full h-full object-contain">
                                </div>
                                ` : ''}

                                <p class="font-bold retro-text mb-2">🎯 OBJECTIVE:</p>
                                <p class="mb-4">${chamber.objective}</p>
                                
                                <p class="font-bold retro-text mb-2">⚔️ MISSION:</p>
                                <div class="mb-4">${chamber.mission}</div>

                                <p class="font-bold retro-text mb-3 mt-6">📺 TUTORIAL:</p>
                                <div class="relative w-full max-w-md mx-auto overflow-hidden shadow-md mb-6 video-frame-container" style="padding-top: 56.25%">
                                    <iframe class="absolute top-0 left-0 w-full h-full" src="https://youtu.be/EPRWvLGQ-XA" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="Chamber Tutorial Video Placeholder"></iframe>
                                </div>

                                <p class="font-bold retro-text mb-2">💡 PRO TIP:</p>
                                <p>${chamber.tip}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('<div class="h-4"></div>'); 

            document.getElementById('content-container').innerHTML = `
                <div class="space-y-4">
                    <h2 class="text-4xl font-bold retro-text mb-8">THE SIX CODE CHAMBERS</h2>
                    ${html}
                </div>
                <div class="mt-8 p-4 bg-black border-4 border-red-500 rounded-none shadow-xl">
                    <h3 class="text-xl font-bold text-red-500">📜 MOUNT OLYMPUS CLUE WALL</h3>
                    <p class="text-base mt-2 text-white">THIS IS WHERE HEROES SHARE THEIR KNOWLEDGE! SHARE YOUR SUCCESS: <strong class="text-yellow-400">PROBLEM → CLUE → TAG → CREDIT</strong>.</p>
                </div>
            `;
            lucide.createIcons();
            addChamberListeners();
        }

        function renderAchievements() {
            const html = achievementsData.map(achievement => `
                <div class="p-5 bg-gray-800 border-4 border-yellow-400 retro-bg flex items-center space-x-4">
                    <div class="bg-yellow-400 p-3 rounded-none">
                        <i data-lucide="${achievement.icon}" class="w-6 h-6 text-black"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold retro-text">${achievement.title.toUpperCase()}</h3>
                        <p class="text-base text-white">${achievement.description.toUpperCase()}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('content-container').innerHTML = `
                <h2 class="text-4xl font-bold retro-text mb-8">⚡ POWER-UPS & ACHIEVEMENTS</h2>
                <p class="mb-8 text-base text-white">EARN 4 POWER-UPS TO REACH THE SUMMIT! SHOWCASE YOUR SKILL BEYOND THE BASIC MISSION.</p>
                <div class="grid md:grid-cols-2 gap-6">
                    ${html}
                </div>
            `;
            lucide.createIcons();
        }

        function renderRubric() {
            const rows = rubricData.map(row => `
                <tr class="border-b border-gray-600 hover:bg-gray-700/50">
                    <td class="p-4 font-bold text-cyan-400 text-lg">${row.criteria.toUpperCase()}</td>
                    <td class="p-4 text-sm text-gray-400">🐣 ${row.starting}</td>
                    <td class="p-4 text-sm text-white">⚔️ ${row.getting}</td>
                    <td class="p-4 text-sm font-bold text-green-400">🏆 ${row.master}</td>
                </tr>
            `).join('');

            document.getElementById('content-container').innerHTML = `
                <h2 class="text-4xl font-bold retro-text mb-8">⚔️ ASSESSMENT SCORECARD</h2>
                <p class="mb-8 text-base text-white">YOUR FINAL STATUS WILL BE BASED ON THE QUALITY AND COMPLETENESS OF YOUR GAME. AIM FOR MASTER HERO STATUS.</p>

                <div class="overflow-x-auto bg-gray-800 border-4 border-cyan-400 retro-bg">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead>
                            <tr class="bg-black text-yellow-400">
                                <th class="p-4 text-left font-bold text-base">CRITERIA</th>
                                <th class="p-4 text-left font-bold text-base">STARTING HERO (🐣)</th>
                                <th class="p-4 text-left font-bold text-base">GETTING THERE (⚔️)</th>
                                <th class="p-4 text-left font-bold text-base">MASTER HERO (🏆)</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-700">
                            ${rows}
                        </tbody>
                    </table>
                </div>

                <div class="mt-8 p-4 bg-black border-4 border-red-500 retro-bg">
                    <h3 class="text-xl font-bold text-red-500">📝 TEAM PASSPORT (TRACKING)</h3>
                    <p class="text-base mt-2 text-white">USE THIS TO TRACK YOUR TEAM NAME, ROLES, TOKENS, AND REFLECTIONS.</p>
                </div>
            `;
            lucide.createIcons();
        }

        function setActiveTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                const isActive = btn.getAttribute('data-tab') === tabName;
                
                btn.classList.remove('active-tab-retro', 'hover:retro-button-hover');

                if (isActive) {
                    btn.classList.add('active-tab-retro');
                    btn.classList.remove('text-white');
                } else {
                    btn.classList.add('text-white', 'hover:retro-button-hover');
                }
            });
            localStorage.setItem('activeTab', tabName);
        }

        function renderActiveTab() {
            const activeTab = localStorage.getItem('activeTab') || 'chambers';
            setActiveTab(activeTab);

            switch (activeTab) {
                case 'chambers':
                    renderChambers();
                    break;
                case 'achievements':
                    renderAchievements();
                    break;
                case 'rubric':
                    renderRubric();
                    break;
                default:
                    renderChambers();
            }
        }

        window.toggleChamberContent = function(id) {
            const card = document.getElementById(id);
            const content = card.querySelector('.chamber-content');
            const icon = card.querySelector('.chamber-toggle-icon');

            content.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        }

        function addChamberListeners() {
            document.querySelectorAll('.toggle-complete').forEach(button => {
                button.onclick = (e) => {
                    e.stopPropagation(); 
                    const chamberId = button.getAttribute('data-chamber-id');
                    const isCurrentlyComplete = userProgress[chamberId] === true;
                    updateProgress(chamberId, !isCurrentlyComplete);
                };
            });
        }

        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');
                setActiveTab(tabName);
                renderActiveTab();
            });
        });

        initializeFirebase();
        lucide.createIcons();
    </script>
</body>
</html>
